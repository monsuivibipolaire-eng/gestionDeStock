import{a as te}from"./chunk-NQL5HIXM.js";import"./chunk-VAUZXUCP.js";import{b as P,c as T,d as G,e as q,g as R,h as U,j as W,m as Y,n as J,o as K,p as Q,r as X,s as Z,t as ee}from"./chunk-JJK6J4PC.js";import"./chunk-ERIR3R6Y.js";import{A as O,Ia as l,Ib as i,Jb as y,Kb as S,O as A,Sa as V,Vb as I,Wa as B,Wb as L,_a as _,jb as c,k as F,ka as w,kb as t,la as E,lb as e,ma as M,mb as x,na as k,tb as $,tc as D,ub as u,uc as j,wb as v,wc as z,yc as H,z as N}from"./chunk-JV3ZGQQZ.js";function oe(a,d){if(a&1){let s=$();t(0,"div",31)(1,"strong"),i(2,"Erreur :"),e(),i(3),t(4,"button",32),u("click",function(){w(s);let n=v();return E(n.errorMessage="")}),i(5,"\xD7"),e()()}if(a&2){let s=v();l(3),S(" ",s.errorMessage," ")}}function le(a,d){a&1&&(t(0,"span"),i(1,"+ Ajouter"),e())}function se(a,d){a&1&&(t(0,"span"),i(1,"Fermer"),e())}function ae(a,d){a&1&&(t(0,"span"),i(1,"Enregistrement..."),e())}function de(a,d){if(a&1&&(t(0,"span"),i(1),e()),a&2){let s=v(2);l(),y(s.isEditing?"Mettre \xE0 jour":"Ajouter")}}function me(a,d){if(a&1){let s=$();t(0,"div",33)(1,"h2",34),i(2),e(),t(3,"form",35),u("ngSubmit",function(){w(s);let n=v();return E(n.onSubmit())}),t(4,"div",36)(5,"div")(6,"label",37),i(7,"Nom *"),e(),x(8,"input",38),e(),t(9,"div")(10,"label",37),i(11,"Email *"),e(),x(12,"input",39),e(),t(13,"div")(14,"label",37),i(15,"T\xE9l\xE9phone *"),e(),x(16,"input",40),e(),t(17,"div")(18,"label",37),i(19,"Ville"),e(),x(20,"input",41),e()(),t(21,"div")(22,"label",37),i(23,"Adresse"),e(),x(24,"textarea",42),e(),t(25,"div")(26,"label",37),i(27,"Notes"),e(),x(28,"textarea",43),e(),t(29,"div",44)(30,"button",45),_(31,ae,2,0,"span",10)(32,de,2,1,"span",10),e(),t(33,"button",46),u("click",function(){w(s);let n=v();return E(n.resetForm())}),i(34,"Annuler"),e()()()()}if(a&2){let s=v();l(2),S("",s.isEditing?"Modifier":"Nouveau"," Client"),l(),c("formGroup",s.customerForm),l(27),c("disabled",s.isLoading||s.customerForm.invalid),l(),c("ngIf",s.isLoading),l(),c("ngIf",!s.isLoading)}}function pe(a,d){if(a&1){let s=$();t(0,"tr",47)(1,"td",48),i(2),e(),t(3,"td",49)(4,"div",50),i(5),e()(),t(6,"td",51),i(7),e(),t(8,"td",51),i(9),e(),t(10,"td",51),i(11),e(),t(12,"td",52),i(13),e(),t(14,"td",53)(15,"button",54),u("click",function(){let n=w(s).$implicit,o=v();return E(o.editCustomer(n))}),i(16,"Modifier"),e(),t(17,"button",55),u("click",function(){let n=w(s).$implicit,o=v();return E(o.deleteCustomer(n.id,n.name))}),i(18,"Supprimer"),e()()()}if(a&2){let s=d.$implicit,r=d.index;l(2),y(r+1),l(3),y(s.name),l(2),y(s.email||"-"),l(2),y(s.phone||"-"),l(2),y(s.city||"-"),l(2),y(s.address||"-")}}function ce(a,d){a&1&&(t(0,"tr")(1,"td",56),i(2," Aucun client trouv\xE9. "),e()())}var _e=(()=>{let d=class d{constructor(r,n){this.customersService=r,this.fb=n,this.isLoading=!1,this.isEditing=!1,this.editingId=null,this.errorMessage="",this.showForm=!1,this.searchTerm="",this.searchTerm$=new F(""),this.cityFilter=null,this.cityFilter$=new F(null),this.sortBy="name",this.sortBy$=new F("name"),this.sortOrder="asc",this.sortOrder$=new F("asc"),this.customerForm=this.fb.group({name:["",T.required],email:["",[T.required,T.email]],phone:["",T.required],address:[""],city:[""],notes:[""]})}ngOnInit(){this.loadCustomers(),this.filteredCustomers$=O([this.customers$,this.searchTerm$,this.cityFilter$,this.sortBy$,this.sortOrder$]).pipe(N(([r,n,o,m,g])=>{let f=r;return n&&(f=f.filter(h=>h.name.toLowerCase().includes(n.toLowerCase())||h.email?.toLowerCase().includes(n.toLowerCase())||h.phone?.includes(n))),o&&(f=f.filter(h=>h.city?.toLowerCase()===o.toLowerCase())),f=f.sort((h,b)=>{let C=0;return m==="name"?C=h.name.localeCompare(b.name):m==="city"?C=(h.city||"").localeCompare(b.city||""):m==="email"&&(C=(h.email||"").localeCompare(b.email||"")),g==="asc"?C:-C}),f}))}loadCustomers(){this.customers$=this.customersService.getCustomers()}onSearchChange(r){this.searchTerm=r,this.searchTerm$.next(r)}onCityFilterChange(r){this.cityFilter=r,this.cityFilter$.next(r)}onSortChange(r){this.sortBy===r?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortBy=r,this.sortOrder="asc"),this.sortBy$.next(this.sortBy),this.sortOrder$.next(this.sortOrder)}clearFilters(){this.searchTerm="",this.searchTerm$.next(""),this.cityFilter=null,this.cityFilter$.next(null),this.sortBy="name",this.sortBy$.next("name"),this.sortOrder="asc",this.sortOrder$.next("asc")}onSubmit(){if(this.customerForm.invalid){this.errorMessage="Veuillez remplir tous les champs obligatoires.";return}this.isLoading=!0,this.errorMessage="";let r=this.customerForm.value;this.isEditing&&this.editingId?this.customersService.updateCustomer(this.editingId,r).then(()=>{this.resetForm(),this.loadCustomers()}).catch(n=>{this.errorMessage="Erreur lors de la modification.",console.error(n)}).finally(()=>this.isLoading=!1):this.customersService.addCustomer(r).then(()=>{this.resetForm(),this.loadCustomers()}).catch(n=>{this.errorMessage="Erreur lors de l'ajout.",console.error(n)}).finally(()=>this.isLoading=!1)}editCustomer(r){this.isEditing=!0,this.editingId=r.id||null,this.customerForm.patchValue(r),this.showForm=!0,window.scrollTo({top:0,behavior:"smooth"})}deleteCustomer(r,n){confirm(`Supprimer le client "${n}" ?`)&&(this.isLoading=!0,this.customersService.deleteCustomer(r).then(()=>{this.loadCustomers()}).catch(o=>{this.errorMessage="Erreur lors de la suppression.",console.error(o)}).finally(()=>this.isLoading=!1))}resetForm(){this.customerForm.reset(),this.isEditing=!1,this.editingId=null,this.errorMessage="",this.showForm=!1}toggleForm(){this.showForm=!this.showForm,this.showForm||this.resetForm()}printList(){this.filteredCustomers$.pipe(A(1)).subscribe(r=>{if(r.length===0){alert("Aucun client \xE0 imprimer.");return}this.generatePrintHTML(r)})}generatePrintHTML(r){let n=window.open("","_blank","width=900,height=700");if(!n){alert("\u274C Popup bloqu\xE9e !");return}let o=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=r.length,g=[...new Set(r.map(p=>p.city).filter(p=>p))],f=r.filter(p=>p.email).length,h=r.filter(p=>p.phone).length,b=[];this.searchTerm&&b.push(`Recherche: "${this.searchTerm}"`),this.cityFilter&&b.push(`Ville: ${this.cityFilter}`);let C={name:"Nom",city:"Ville",email:"Email"};b.push(`Tri: ${C[this.sortBy]} (${this.sortOrder==="asc"?"\u2191":"\u2193"})`);let ie=r.map((p,ne)=>`
      <tr>
        <td>${ne+1}</td>
        <td><strong>${p.name}</strong></td>
        <td>${p.email||"-"}</td>
        <td>${p.phone||"-"}</td>
        <td>${p.city||"-"}</td>
        <td>${p.address||"-"}</td>
      </tr>
    `).join(""),re=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Liste Clients - ${o}</title>
        <style>
          @page { margin: 15mm; size: A4 landscape; }
          body { font-family: Arial, sans-serif; margin: 0; padding: 15px; font-size: 10pt; }
          .header { text-align: center; margin-bottom: 15px; border-bottom: 2px solid #8b5cf6; padding-bottom: 10px; }
          .header h1 { font-size: 20pt; color: #8b5cf6; margin: 0 0 5px 0; }
          .filters { background: #f5f3ff; padding: 8px; margin-bottom: 12px; border-left: 3px solid #8b5cf6; }
          .filters h3 { font-size: 11pt; margin: 0 0 5px 0; }
          .filters ul { list-style: none; padding: 0; margin: 0; }
          .filters li { font-size: 9pt; margin: 2px 0; }
          .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
          .stat { background: #f9fafb; border: 1px solid #e5e7eb; padding: 8px; text-align: center; }
          .stat .label { font-size: 8pt; color: #666; }
          .stat .value { font-size: 14pt; font-weight: bold; color: #8b5cf6; }
          table { width: 100%; border-collapse: collapse; }
          thead { background: #8b5cf6; color: white; }
          th, td { padding: 6px 8px; text-align: left; border: 1px solid #ddd; font-size: 9pt; }
          tbody tr:nth-child(even) { background: #f9fafb; }
          tfoot { background: #f5f3ff; font-weight: bold; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>\u{1F465} Clients - Liste</h1>
          <p>Date d'impression : ${o}</p>
        </div>
        <div class="filters">
          <h3>Filtres Appliqu\xE9s</h3>
          <ul>${b.map(p=>`<li>\u2022 ${p}</li>`).join("")}</ul>
        </div>
        <div class="stats">
          <div class="stat"><div class="label">Total Clients</div><div class="value">${m}</div></div>
          <div class="stat"><div class="label">Villes</div><div class="value">${g.length}</div></div>
          <div class="stat"><div class="label">Avec Email</div><div class="value">${f}</div></div>
          <div class="stat"><div class="label">Avec T\xE9l\xE9phone</div><div class="value">${h}</div></div>
        </div>
        <table>
          <thead>
            <tr><th>#</th><th>Nom</th><th>Email</th><th>T\xE9l\xE9phone</th><th>Ville</th><th>Adresse</th></tr>
          </thead>
          <tbody>${ie}</tbody>
          <tfoot>
            <tr><td colspan="6">TOTAL : ${m} clients</td></tr>
          </tfoot>
        </table>
      </body>
      </html>
    `;n.document.write(re),n.document.close(),n.focus(),setTimeout(()=>n.print(),500)}};d.\u0275fac=function(n){return new(n||d)(V(te),V(X))},d.\u0275cmp=B({type:d,selectors:[["app-customers"]],decls:62,vars:16,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-6"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",4,"ngIf"],[1,"flex","flex-col","md:flex-row","justify-between","items-center","mb-4","gap-4"],["type","text","placeholder","\u{1F50D} Rechercher (nom, email, t\xE9l\xE9phone)...",1,"w-full","md:w-1/2","px-4","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"bg-purple-600","hover:bg-purple-700","text-white","font-bold","py-2","px-6","rounded-lg","flex","items-center","space-x-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"],[1,"bg-green-600","hover:bg-green-700","text-white","font-bold","py-2","px-6","rounded-lg",3,"click"],[4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","p-4","mb-6"],[1,"text-lg","font-semibold","mb-3","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","placeholder","Filtrer par ville",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],["value","name"],["value","city"],["value","email"],[1,"mt-4"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-4","py-2","rounded-lg",3,"click"],["class","bg-white shadow-md rounded-lg p-6 mb-6",4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","overflow-hidden"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-purple-600","text-white"],[1,"px-6","py-3","text-left","text-xs","font-medium","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","mb-4"],[1,"float-right",3,"click"],[1,"bg-white","shadow-md","rounded-lg","p-6","mb-6"],[1,"text-2xl","font-semibold","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-gray-700","font-medium","mb-2"],["formControlName","name","type","text",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","email","type","email",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","phone","type","text",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","city","type","text",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","address","rows","2",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","notes","rows","2",1,"w-full","px-4","py-2","border","rounded-lg"],[1,"flex","gap-4"],["type","submit",1,"bg-blue-600","hover:bg-blue-700","text-white","font-bold","py-2","px-6","rounded-lg","disabled:bg-gray-400",3,"disabled"],["type","button",1,"bg-gray-500","hover:bg-gray-600","text-white","font-bold","py-2","px-6","rounded-lg",3,"click"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-gray-500"],[1,"px-6","py-4","text-sm","text-gray-500"],[1,"px-6","py-4","whitespace-nowrap","text-sm","font-medium"],[1,"text-indigo-600","hover:text-indigo-900","mr-3",3,"click"],[1,"text-red-600","hover:text-red-900",3,"click"],["colspan","7",1,"px-6","py-8","text-center","text-gray-500"]],template:function(n,o){if(n&1&&(t(0,"div",0)(1,"h1",1),i(2,"Clients"),e(),_(3,oe,6,1,"div",2),t(4,"div",3)(5,"input",4),u("ngModelChange",function(g){return o.onSearchChange(g)}),e(),t(6,"div",5)(7,"button",6),u("click",function(){return o.printList()}),M(),t(8,"svg",7),x(9,"path",8),e(),k(),t(10,"span"),i(11,"Imprimer Liste"),e()(),t(12,"button",9),u("click",function(){return o.toggleForm()}),_(13,le,2,0,"span",10)(14,se,2,0,"span",10),e()()(),t(15,"div",11)(16,"h3",12),M(),t(17,"svg",13),x(18,"path",14),e(),i(19," Filtres Avanc\xE9s "),e(),k(),t(20,"div",15)(21,"div")(22,"label",16),i(23,"Ville"),e(),t(24,"input",17),u("ngModelChange",function(g){return o.onCityFilterChange(g)}),e()(),t(25,"div")(26,"label",16),i(27,"Trier par"),e(),t(28,"select",18),u("ngModelChange",function(g){return o.onSortChange(g)}),t(29,"option",19),i(30),e(),t(31,"option",20),i(32),e(),t(33,"option",21),i(34),e()()()(),t(35,"div",22)(36,"button",23),u("click",function(){return o.clearFilters()}),i(37," R\xE9initialiser Filtres "),e()()(),_(38,me,35,5,"div",24),t(39,"div",25)(40,"table",26)(41,"thead",27)(42,"tr")(43,"th",28),i(44,"#"),e(),t(45,"th",28),i(46,"Nom"),e(),t(47,"th",28),i(48,"Email"),e(),t(49,"th",28),i(50,"T\xE9l\xE9phone"),e(),t(51,"th",28),i(52,"Ville"),e(),t(53,"th",28),i(54,"Adresse"),e(),t(55,"th",28),i(56,"Actions"),e()()(),t(57,"tbody",29),_(58,pe,19,6,"tr",30),I(59,"async"),_(60,ce,3,0,"tr",10),I(61,"async"),e()()()()),n&2){let m;l(3),c("ngIf",o.errorMessage),l(2),c("ngModel",o.searchTerm),l(8),c("ngIf",!o.showForm),l(),c("ngIf",o.showForm),l(10),c("ngModel",o.cityFilter),l(4),c("ngModel",o.sortBy),l(2),S("Nom ",o.sortBy==="name"?o.sortOrder==="asc"?"\u2191":"\u2193":""),l(2),S("Ville ",o.sortBy==="city"?o.sortOrder==="asc"?"\u2191":"\u2193":""),l(2),S("Email ",o.sortBy==="email"?o.sortOrder==="asc"?"\u2191":"\u2193":""),l(4),c("ngIf",o.showForm),l(20),c("ngForOf",L(59,12,o.filteredCustomers$)),l(2),c("ngIf",((m=L(61,14,o.filteredCustomers$))==null?null:m.length)===0)}},dependencies:[ee,U,K,Q,P,J,G,q,W,Y,H,D,j,Z,R,z],styles:[".container[_ngcontent-%COMP%]{max-width:1200px}"]});let a=d;return a})();export{_e as CustomersComponent};
