import{a as Te}from"./chunk-UWHKPDZO.js";import{a as $e,b as De}from"./chunk-JFFEMBUM.js";import{c as ae}from"./chunk-NAZHZL2Z.js";import{a as Fe}from"./chunk-MNEFO67F.js";import{a as D,b as Se,d as we,f as U,h as M,i as k,k as Ce,l as Ve,n as z}from"./chunk-37E4UQA3.js";import{b as le,c as E,d as de,e as se,g as ce,h as ue,i as pe,j as me,k as he,l as ge,m as fe,n as xe,o as be,p as ve,r as ye,s as _e,t as Ee}from"./chunk-JJK6J4PC.js";import"./chunk-ERIR3R6Y.js";import{A as J,Ia as d,Ib as o,Jb as A,Kb as _,O as G,Qb as R,Sa as N,Vb as w,Wa as Z,Wb as B,Xb as P,_a as F,a as q,aa as K,b as O,d as j,db as ee,ea as X,jb as h,k as $,ka as C,kb as n,la as V,lb as i,ma as H,mb as T,na as Q,tb as L,tc as te,ub as x,uc as ie,wb as b,wc as ne,xc as re,yc as oe,z as Y}from"./chunk-JV3ZGQQZ.js";var Me=(()=>{let u=class u{constructor(e){this.firestore=e}getEntryVouchers(){let e=U(this.firestore,"entryVouchers"),r=Ve(e,Ce("date","desc"));return we(r,{idField:"id"})}addEntryVoucher(e){return j(this,null,function*(){let r=U(this.firestore,"entryVouchers"),t=z(this.firestore),l=M(r);t.set(l,O(q({},e),{createdAt:D.now()}));for(let s of e.products){let m=M(this.firestore,"products",s.productId),g=yield k(m);if(g.exists()){let y=g.data().quantity||0;t.update(m,{quantity:y+s.quantity})}}yield t.commit()})}updateEntryVoucher(e,r){return j(this,null,function*(){let t=M(this.firestore,"entryVouchers",e),l=z(this.firestore),s=yield k(t);if(s.exists()){let m=s.data();if(m.products)for(let g of m.products){let y=M(this.firestore,"products",g.productId),S=yield k(y);if(S.exists()){let f=S.data().quantity||0;l.update(y,{quantity:f-g.quantity})}}if(r.products)for(let g of r.products){let y=M(this.firestore,"products",g.productId),S=yield k(y);if(S.exists()){let f=S.data().quantity||0;l.update(y,{quantity:f+g.quantity})}}}l.update(t,r),yield l.commit()})}deleteEntryVoucher(e){return j(this,null,function*(){let r=M(this.firestore,"entryVouchers",e),t=z(this.firestore),l=yield k(r);if(l.exists()){let s=l.data();if(s.products)for(let m of s.products){let g=M(this.firestore,"products",m.productId),y=yield k(g);if(y.exists()){let S=y.data().quantity||0;t.update(g,{quantity:Math.max(0,S-m.quantity)})}}}t.delete(r),yield t.commit()})}generateVoucherNumber(){let e=new Date,r=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),s=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`ENT-${r}${t}${l}-${s}`}};u.\u0275fac=function(r){return new(r||u)(X(Se))},u.\u0275prov=K({token:u,factory:u.\u0275fac,providedIn:"root"});let c=u;return c})();var W=()=>[];function Ne(c,u){if(c&1){let a=L();n(0,"div",29)(1,"strong"),o(2,"Erreur :"),i(),o(3),n(4,"button",30),x("click",function(){C(a);let r=b();return V(r.errorMessage="")}),o(5,"\xD7"),i()()}if(c&2){let a=b();d(3),_(" ",a.errorMessage," ")}}function Le(c,u){c&1&&(n(0,"span"),o(1,"+ Ajouter Bon"),i())}function Be(c,u){c&1&&(n(0,"span"),o(1,"Fermer"),i())}function qe(c,u){if(c&1&&(n(0,"option",63),o(1),i()),c&2){let a=u.$implicit;h("value",a.id),d(),A(a.name)}}function Oe(c,u){if(c&1){let a=L();n(0,"div",50)(1,"div",51)(2,"label",52),o(3,"Produit *"),i(),n(4,"select",53),x("change",function(r){let t=C(a).index,l=b(2);return V(l.onProductSelected(r,t))}),n(5,"option",54),o(6,"-- S\xE9lectionnez --"),i(),F(7,qe,2,2,"option",55),w(8,"async"),i()(),n(9,"div",56)(10,"label",52),o(11,"Quantit\xE9 *"),i(),T(12,"input",57),i(),n(13,"div",56)(14,"label",52),o(15,"Prix Unit. (DT) *"),i(),T(16,"input",58),i(),n(17,"div",56)(18,"label",52),o(19,"Sous-total"),i(),T(20,"input",59),w(21,"number"),i(),n(22,"div",60)(23,"button",61),x("click",function(){C(a);let r=b(2);return V(r.addProductLine())}),o(24," + "),i(),n(25,"button",62),x("click",function(){let r=C(a).index,t=b(2);return V(t.removeProductLine(r))}),o(26," - "),i()()()}if(c&2){let a=u.index,e=b(2);h("formGroupName",a),d(7),h("ngForOf",B(8,4,e.products$)),d(13),h("value",P(21,6,e.calculateSubtotal(a),"1.2-2")),d(5),h("disabled",e.productsFormArray.length===1)}}function je(c,u){c&1&&(n(0,"span"),o(1,"Enregistrement..."),i())}function Re(c,u){if(c&1&&(n(0,"span"),o(1),i()),c&2){let a=b(2);d(),A(a.isEditing?"Mettre \xE0 jour":"Cr\xE9er Bon")}}function ze(c,u){if(c&1){let a=L();n(0,"div",31)(1,"h2",32),o(2),i(),n(3,"form",33),x("ngSubmit",function(){C(a);let r=b();return V(r.onSubmit())}),n(4,"div",34)(5,"div")(6,"label",35),o(7,"N\xB0 Bon *"),i(),T(8,"input",36),i(),n(9,"div")(10,"label",35),o(11,"Date *"),i(),T(12,"input",37),i(),n(13,"div")(14,"label",35),o(15,"Fournisseur *"),i(),T(16,"ng-select",38),w(17,"async"),i()(),n(18,"div",39)(19,"h3",40),o(20,"Produits"),i(),n(21,"div",41),F(22,Oe,27,9,"div",42),i(),n(23,"div",43)(24,"div",44)(25,"span"),o(26,"Total :"),i(),n(27,"span",45),o(28),w(29,"number"),i()()()(),n(30,"div")(31,"label",35),o(32,"Notes"),i(),T(33,"textarea",46),i(),n(34,"div",47)(35,"button",48),F(36,je,2,0,"span",10)(37,Re,2,1,"span",10),i(),n(38,"button",49),x("click",function(){C(a);let r=b();return V(r.resetForm())}),o(39," Annuler "),i()()()()}if(c&2){let a=b();d(2),_(" ",a.isEditing?"Modifier":"Nouveau"," Bon d'Entr\xE9e "),d(),h("formGroup",a.voucherForm),d(13),h("items",B(17,10,a.suppliers$)??R(15,W))("searchable",!0)("clearable",!0),d(6),h("ngForOf",a.productsFormArray.controls),d(6),_("",P(29,12,a.calculateTotal(),"1.2-2")," DT"),d(7),h("disabled",a.isLoading||a.voucherForm.invalid),d(),h("ngIf",a.isLoading),d(),h("ngIf",!a.isLoading)}}function Ge(c,u){if(c&1&&(n(0,"tr",84)(1,"td",85),o(2),i(),n(3,"td",85),o(4),i(),n(5,"td",85),o(6),i(),n(7,"td",85),o(8),i(),n(9,"td",85),o(10),w(11,"number"),i(),n(12,"td",85),o(13),w(14,"number"),i()()),c&2){let a=u.$implicit;d(2),A(a.productId),d(2),A(a.productName),d(2),A(a.description),d(2),A(a.quantity),d(2),_("",P(11,6,a.unitPrice,"1.2-2")," DT"),d(3),_("",P(14,9,a.subtotal,"1.2-2")," DT")}}function He(c,u){if(c&1){let a=L();n(0,"div",72)(1,"table",73)(2,"thead",74)(3,"tr")(4,"th",75),o(5,"ID"),i(),n(6,"th",75),o(7,"Nom Produit"),i(),n(8,"th",75),o(9,"Description"),i(),n(10,"th",75),o(11,"Quantit\xE9"),i(),n(12,"th",75),o(13,"Prix Unit"),i(),n(14,"th",75),o(15,"Sous-total"),i()()(),n(16,"tbody"),F(17,Ge,15,12,"tr",76),n(18,"tr",77)(19,"td",78),o(20,"Total :"),i(),n(21,"td",79),o(22),w(23,"number"),i()()()(),n(24,"div",80)(25,"button",81),x("click",function(){C(a);let r=b().$implicit,t=b(2);return V(t.editVoucher(r))}),o(26," Modifier "),i(),n(27,"button",82),x("click",function(){C(a);let r=b().$implicit,t=b(2);return V(t.deleteVoucher(r.id,r.voucherNumber))}),o(28," Supprimer "),i(),n(29,"button",83),x("click",function(){C(a);let r=b().$implicit,t=b(2);return V(t.printItem(r))}),o(30," Imprimer ce Bon "),i()()()}if(c&2){let a=b().$implicit;d(17),h("ngForOf",(a==null?null:a.products)||R(5,W)),d(5),_(" ",P(23,2,a==null?null:a.totalAmount,"1.2-2")," DT ")}}function Qe(c,u){if(c&1){let a=L();n(0,"div",67)(1,"div",68),x("click",function(){let r=C(a).$implicit,t=b(2);return V(t.toggleExpand(r.id))}),n(2,"div",69)(3,"div")(4,"strong"),o(5,"N\xB0 :"),i(),o(6),i(),n(7,"div")(8,"strong"),o(9,"Date:"),i(),o(10),i(),n(11,"div")(12,"strong"),o(13,"Fournisseur:"),i(),o(14),i(),n(15,"div")(16,"strong"),o(17,"Total:"),i(),o(18),w(19,"number"),i()(),n(20,"button",70),o(21),i()(),F(22,He,31,6,"div",71),i()}if(c&2){let a=u.$implicit,e=b(2);ee("data-id",a.id),d(6),_(" ",a.voucherNumber),d(4),_(" ",e.formatDate(a.date)),d(4),_(" ",a.supplier),d(4),_(" ",P(19,7,a.totalAmount,"1.2-2")," DT"),d(3),_(" ",e.expandedVoucherId===a.id?"\u25BC":"\u25BA"," "),d(),h("ngIf",e.expandedVoucherId===a.id)}}function Ue(c,u){c&1&&(n(0,"div",86),o(1," Aucun bon trouv\xE9. "),i())}function We(c,u){if(c&1&&(n(0,"div",64),F(1,Qe,23,10,"div",65),w(2,"async"),F(3,Ue,2,0,"div",66),w(4,"async"),i()),c&2){let a,e=b();d(),h("ngForOf",B(2,2,e.filteredVouchers$)),d(2),h("ngIf",((a=B(4,4,e.filteredVouchers$))==null?null:a.length)===0)}}var ut=(()=>{let u=class u{constructor(e,r,t,l,s){this.vouchersService=e,this.productsService=r,this.suppliersService=t,this.fb=l,this.router=s,this.productList=[],this.isLoading=!1,this.isEditing=!1,this.editingId=null,this.errorMessage="",this.showForm=!1,this.expandedVoucherId=null,this.searchTerm="",this.searchTerm$=new $(""),this.selectedSupplier=null,this.selectedSupplier$=new $(null),this.dateFrom=null,this.dateFrom$=new $(null),this.dateTo=null,this.dateTo$=new $(null),this.minAmount=null,this.minAmount$=new $(null),this.maxAmount=null,this.maxAmount$=new $(null),this.sortBy="date",this.sortBy$=new $("date"),this.sortOrder="desc",this.sortOrder$=new $("desc");let m=new Date().toISOString().split("T")[0];this.voucherForm=this.fb.group({voucherNumber:[this.vouchersService.generateVoucherNumber(),E.required],date:[m,E.required],supplier:["",E.required],products:this.fb.array([this.createProductLine()]),notes:[""]})}ngOnInit(){this.loadVouchers(),this.products$=this.productsService.getProducts(),this.products$.subscribe(e=>{this.productList=e}),this.suppliers$=this.suppliersService.getSuppliers(),this.filteredVouchers$=J([this.vouchers$,this.searchTerm$,this.selectedSupplier$,this.dateFrom$,this.dateTo$,this.minAmount$,this.maxAmount$,this.sortBy$,this.sortOrder$]).pipe(Y(([e,r,t,l,s,m,g,y,S])=>{let f=e;if(r&&(f=f.filter(p=>p.voucherNumber.toLowerCase().includes(r.toLowerCase()))),t&&(f=f.filter(p=>p.supplier===t)),l){let p=new Date(l);f=f.filter(v=>(v.date instanceof D?v.date.toDate():new Date(v.date))>=p)}if(s){let p=new Date(s);p.setHours(23,59,59),f=f.filter(v=>(v.date instanceof D?v.date.toDate():new Date(v.date))<=p)}return m!==null&&(f=f.filter(p=>(p.totalAmount||0)>=m)),g!==null&&(f=f.filter(p=>(p.totalAmount||0)<=g)),f=f.sort((p,v)=>{let I=0;if(y==="date"){let Ie=p.date instanceof D?p.date.toDate().getTime():new Date(p.date).getTime(),Ae=v.date instanceof D?v.date.toDate().getTime():new Date(v.date).getTime();I=Ie-Ae}else y==="supplier"?I=p.supplier.localeCompare(v.supplier):y==="amount"&&(I=(p.totalAmount||0)-(v.totalAmount||0));return S==="asc"?I:-I}),f}))}get productsFormArray(){return this.voucherForm.get("products")}createProductLine(){return this.fb.group({productId:["",E.required],quantity:[1,[E.required,E.min(1)]],unitPrice:[0,[E.required,E.min(.01)]]})}addProductLine(){this.productsFormArray.push(this.createProductLine())}removeProductLine(e){this.productsFormArray.length>1&&this.productsFormArray.removeAt(e)}calculateSubtotal(e){let r=this.productsFormArray.at(e).value;return(r.quantity||0)*(r.unitPrice||0)}calculateTotal(){return this.productsFormArray.controls.reduce((e,r)=>{let t=r.value;return e+(t.quantity||0)*(t.unitPrice||0)},0)}loadVouchers(){this.vouchers$=this.vouchersService.getEntryVouchers()}onSearchChange(e){this.searchTerm=e,this.searchTerm$.next(e)}onSupplierFilterChange(e){this.selectedSupplier=e,this.selectedSupplier$.next(e)}onDateFromChange(e){this.dateFrom=e,this.dateFrom$.next(e)}onDateToChange(e){this.dateTo=e,this.dateTo$.next(e)}onMinAmountChange(e){this.minAmount=e,this.minAmount$.next(e)}onMaxAmountChange(e){this.maxAmount=e,this.maxAmount$.next(e)}onSortChange(e){this.sortBy===e?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortBy=e,this.sortOrder=this.sortBy==="date"?"desc":"asc"),this.sortBy$.next(this.sortBy),this.sortOrder$.next(this.sortOrder)}clearFilters(){this.searchTerm="",this.searchTerm$.next(""),this.selectedSupplier=null,this.selectedSupplier$.next(null),this.dateFrom=null,this.dateFrom$.next(null),this.dateTo=null,this.dateTo$.next(null),this.minAmount=null,this.minAmount$.next(null),this.maxAmount=null,this.maxAmount$.next(null),this.sortBy="date",this.sortBy$.next("date"),this.sortOrder="desc",this.sortOrder$.next("desc")}onSubmit(){if(this.voucherForm.invalid){this.errorMessage="Veuillez remplir tous les champs obligatoires.";return}this.isLoading=!0,this.errorMessage="";let e=this.voucherForm.value,r=e.products.map(l=>{let s=this.productList.find(S=>S.id===l.productId),m=s?s.name:"Produit_Inconnu",g=s&&s.description||"Pas_de_description",y=(l.quantity||0)*(l.unitPrice||0);return O(q({},l),{productName:m,description:g,subtotal:y})}),t={voucherNumber:e.voucherNumber,date:D.fromDate(new Date(e.date)),supplier:e.supplier,products:r,totalAmount:this.calculateTotal(),notes:e.notes};this.isEditing&&this.editingId?this.vouchersService.updateEntryVoucher(this.editingId,t).then(()=>{this.resetForm(),this.loadVouchers()}).catch(l=>{this.errorMessage="Erreur lors de la modification.",console.error(l)}).finally(()=>this.isLoading=!1):this.vouchersService.addEntryVoucher(t).then(()=>{this.resetForm(),this.loadVouchers()}).catch(l=>{this.errorMessage="Erreur lors de l'ajout.",console.error(l)}).finally(()=>this.isLoading=!1)}editVoucher(e){this.isEditing=!0,this.editingId=e.id||null;let r=e.date.toDate().toISOString().split("T")[0];this.productsFormArray.clear(),e.products.forEach(t=>{this.productsFormArray.push(this.fb.group({productId:[t.productId,E.required],quantity:[t.quantity,[E.required,E.min(1)]],unitPrice:[t.unitPrice,[E.required,E.min(.01)]]}))}),this.voucherForm.patchValue({voucherNumber:e.voucherNumber,date:r,supplier:e.supplier,notes:e.notes}),this.showForm=!0,window.scrollTo({top:0,behavior:"smooth"})}deleteVoucher(e,r){confirm(`Supprimer le bon "${r}" ?`)&&(this.isLoading=!0,this.vouchersService.deleteEntryVoucher(e).then(()=>{this.loadVouchers()}).catch(t=>{this.errorMessage="Erreur lors de la suppression.",console.error(t)}).finally(()=>this.isLoading=!1))}resetForm(){this.productsFormArray.clear(),this.productsFormArray.push(this.createProductLine());let e=new Date().toISOString().split("T")[0];this.voucherForm.patchValue({voucherNumber:this.vouchersService.generateVoucherNumber(),date:e,supplier:"",notes:""}),this.isEditing=!1,this.editingId=null,this.errorMessage="",this.showForm=!1}toggleForm(){this.showForm=!this.showForm,this.showForm||this.resetForm()}toggleExpand(e){this.expandedVoucherId=this.expandedVoucherId===e?null:e}getProductName(e){let r=this.productList.find(t=>t.id===e);return r?r.name:"Produit_Inconnu"}getDescription(e){return this.productList.find(t=>t.id===e)?.description||"Pas_de_description"}getSubtotal(e){let r=e&&typeof e.quantity=="number"?e.quantity:0,t=e&&typeof e.unitPrice=="number"?e.unitPrice:0;return r*t}formatDate(e){return e instanceof D?e.toDate().toLocaleDateString("fr-FR"):new Date(e).toLocaleDateString("fr-FR")}printList(){this.filteredVouchers$.pipe(G(1)).subscribe(e=>{if(e.length===0){alert("Aucun bon \xE0 imprimer (liste vide apr\xE8s filtres).");return}this.generatePrintHTML(e)})}generatePrintHTML(e){let r=window.open("","_blank","width=900,height=700");if(!r){alert("\u274C Popup bloqu\xE9e ! Autorisez les popups.");return}let t=new Date().toLocaleDateString("fr-FR",{}),l=e.length,s=e.reduce((p,v)=>p+(v.totalAmount||0),0),m=e.reduce((p,v)=>p+v.products.length,0),g=[];this.searchTerm&&g.push(`Recherche: "${this.searchTerm}"`),this.selectedSupplier&&g.push(`Fournisseur: ${this.selectedSupplier}`),this.dateFrom&&g.push(`Date D\xE9but: ${new Date(this.dateFrom).toLocaleDateString("fr-FR")}`),this.dateTo&&g.push(`Date Fin: ${new Date(this.dateTo).toLocaleDateString("fr-FR")}`),this.minAmount!==null&&g.push(`Montant Min: ${this.minAmount} DT`),this.maxAmount!==null&&g.push(`Montant Max: ${this.maxAmount} DT`);let y={date:"Date",supplier:"Fournisseur",amount:"Montant"};g.push(`Tri: ${y[this.sortBy]} (${this.sortOrder==="asc"?"\u2191":"\u2193"})`);let S=e.map((p,v)=>`
      <tr>
        <td>${v+1}</td>
        <td>${p.voucherNumber}</td>
        <td>${this.formatDate(p.date)}</td>
        <td>${p.supplier}</td>
        <td>${p.products.length}</td>
        <td>${(p.totalAmount||0).toFixed(2)} DT</td>
      </tr>
    `).join(""),f=`
      <!DOCTYPE html><html><head>
        <meta charset="UTF-8"><title>Liste Bons d'Entr\xE9e - ${t}</title>
        <style> /* ... CSS Styles ... */
          @page { margin: 15mm; size: A4 landscape; }
          body { font-family: Arial, sans-serif; margin: 0; padding: 15px; font-size: 10pt; }
          .header { text-align: center; margin-bottom: 15px; border-bottom: 2px solid #2563eb; padding-bottom: 10px; }
          .header h1 { font-size: 20pt; color: #2563eb; margin: 0 0 5px 0; }
          .filters { background: #f3f4f6; padding: 8px; margin-bottom: 12px; border-left: 3px solid #2563eb; }
          .filters h3 { font-size: 11pt; margin: 0 0 5px 0; }
          .filters ul { list-style: none; padding: 0; margin: 0; }
          .filters li { font-size: 9pt; margin: 2px 0; }
          .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
          .stat { background: #f9fafb; border: 1px solid #e5e7eb; padding: 8px; text-align: center; }
          .stat .label { font-size: 8pt; color: #666; }
          .stat .value { font-size: 14pt; font-weight: bold; color: #2563eb; }
          table { width: 100%; border-collapse: collapse; }
          thead { background: #2563eb; color: white; }
          th, td { padding: 6px 8px; text-align: left; border: 1px solid #ddd; font-size: 9pt; }
          tbody tr:nth-child(even) { background: #f9fafb; }
          tfoot { background: #f3f4f6; font-weight: bold; }
        </style>
      </head><body>
        <div class="header"><h1>\u{1F4E5} Bons d'Entr\xE9e - Liste</h1><p>Date d'impression : ${t}</p></div>
        <div class="filters"><h3>Filtres Appliqu\xE9s</h3><ul>${g.map(p=>`<li>\u2022 ${p}</li>`).join("")}</ul></div>
        <div class="stats">
          <div class="stat"><div class="label">Total Bons</div><div class="value">${l}</div></div>
          <div class="stat"><div class="label">Total Produits</div><div class="value">${m}</div></div>
          <div class="stat"><div class="label">Montant Total</div><div class="value">${s.toFixed(2)} DT</div></div>
        </div>
        <table><thead><tr><th>#</th><th>N\xB0 Bon</th><th>Date</th><th>Fournisseur</th><th>Produits</th><th>Montant</th></tr></thead>
          <tbody>${S}</tbody>
          <tfoot><tr><td colspan="4">TOTAL (${l} bons)</td><td>${m}</td><td>${s.toFixed(2)} DT</td></tr></tfoot>
        </table>
      </body></html>
    `;r.document.write(f),r.document.close(),r.focus(),setTimeout(()=>r.print(),500)}printItem(e){this.filteredVouchers$.pipe(G(1)).subscribe(r=>{let t=r.find(m=>m.id===e.id);if(!t)return;let l=window.open("","_blank","width=800,height=600");if(!l)return;let s=`
        <!DOCTYPE html><html><head>
          <meta charset="UTF-8"><title>Bon d'Entr\xE9e ${t.voucherNumber}</title>
          <style>
            body { font-family: Arial, sans-serif; padding: 20px; }
            h1 { text-align: center; border-bottom: 2px solid #000; }
            table { width: 100%; border-collapse: collapse; margin: 15px 0; }
            th, td { padding: 8px; border: 1px solid #ddd; }
            th { background: #f3f4f6; }
            .description { font-size: 10px; color: #666; font-style: italic; max-width: 150px; word-wrap: break-word; }
          </style>
        </head><body>
          <h1>Bon d'Entr\xE9e N\xB0 ${t.voucherNumber}</h1>
          <table>
            <tr><th>Date</th><td>${this.formatDate(t.date)}</td></tr>
            <tr><th>Fournisseur</th><td>${t.supplier}</td></tr>
          </table>
          <h3>Produits</h3>
          <table><thead><tr><th>Produit</th><th>Description</th><th>Quantit\xE9</th><th>Prix Unit.</th><th>Sous-total</th></tr></thead>
            <tbody>
              ${t.products.map(m=>`
                <tr>
                  <td>${m.productName}</td>
                  <td class="description">${this.getDescription(m.productId)}</td>
                  <td>${m.quantity}</td>
                  <td>${m.unitPrice.toFixed(2)} DT</td>
                  <td>${m.subtotal.toFixed(2)} DT</td>
                </tr>
              `).join("")}
            </tbody>
            <tfoot><tr><th colspan="4">Total</th><th>${(t.totalAmount||0).toFixed(2)} DT</th></tr></tfoot>
          </table>
        </body></html>
      `;l.document.write(s),l.document.close(),setTimeout(()=>{l.print(),l.close()},250)})}onProductSelected(e,r){let l=e.target.value,s=this.productsFormArray.at(r);if(!l||!s){s?.patchValue({unitPrice:0});return}let m=this.productList.find(g=>g.id===l);m?s.patchValue({unitPrice:m.price}):(s.patchValue({unitPrice:0}),console.warn(`Product not found in productList: ${l}`))}};u.\u0275fac=function(r){return new(r||u)(N(Me),N(Fe),N(Te),N(ye),N(ae))},u.\u0275cmp=Z({type:u,selectors:[["app-entry-voucher"]],decls:57,vars:20,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-6"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",4,"ngIf"],[1,"flex","flex-col","md:flex-row","justify-between","items-center","mb-4","gap-4"],["type","text","placeholder","\u{1F50D} Rechercher par num\xE9ro bon...",1,"w-full","md:w-1/3","px-4","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"bg-purple-600","hover:bg-purple-700","text-white","font-bold","py-2","px-6","rounded-lg","flex","items-center","space-x-2","no-print",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"],[1,"bg-green-600","hover:bg-green-700","text-white","font-bold","py-2","px-6","rounded-lg","no-print",3,"click"],[4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","p-4","mb-6","no-print"],[1,"text-lg","font-semibold","mb-3","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["bindLabel","name","bindValue","name","placeholder","Tous",1,"w-full",3,"ngModelChange","ngModel","items","clearable"],["type","date",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],["value","date"],["value","supplier"],["value","amount"],["type","number","placeholder","0",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],["type","number","placeholder","10000",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"mt-4"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-4","py-2","rounded-lg",3,"click"],["class","bg-white shadow-md rounded-lg p-6 mb-6 no-print",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","mb-4"],[1,"float-right",3,"click"],[1,"bg-white","shadow-md","rounded-lg","p-6","mb-6","no-print"],[1,"text-2xl","font-semibold","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4"],[1,"block","text-gray-700","font-medium","mb-2"],["formControlName","voucherNumber","type","text","readonly","",1,"w-full","px-4","py-2","border","rounded-lg","bg-gray-100"],["formControlName","date","type","date",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","supplier","bindLabel","name","bindValue","name","placeholder","-- S\xE9lectionnez --",1,"w-full",3,"items","searchable","clearable"],[1,"border-t","pt-4"],[1,"text-lg","font-semibold","mb-3"],["formArrayName","products",1,"space-y-3"],["class","grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-gray-50 p-3 rounded",3,"formGroupName",4,"ngFor","ngForOf"],[1,"mt-4","bg-blue-50","p-4","rounded"],[1,"flex","justify-between","text-xl","font-bold"],[1,"text-blue-600"],["formControlName","notes","rows","2",1,"w-full","px-4","py-2","border","rounded-lg"],[1,"flex","gap-4"],["type","submit",1,"bg-blue-600","hover:bg-blue-700","text-white","font-bold","py-2","px-6","rounded-lg","disabled:bg-gray-400",3,"disabled"],["type","button",1,"bg-gray-500","hover:bg-gray-600","text-white","font-bold","py-2","px-6","rounded-lg",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-12","gap-3","items-end","bg-gray-50","p-3","rounded",3,"formGroupName"],[1,"md:col-span-4"],[1,"block","text-sm","text-gray-600","mb-1"],["formControlName","productId",1,"w-full","px-3","py-2","border","rounded",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"md:col-span-2"],["formControlName","quantity","type","number",1,"w-full","px-3","py-2","border","rounded"],["formControlName","unitPrice","type","number","step","0.01",1,"w-full","px-3","py-2","border","rounded"],["readonly","",1,"w-full","px-3","py-2","border","rounded","bg-gray-100",3,"value"],[1,"md:col-span-2","flex","gap-2"],["type","button",1,"bg-blue-500","text-white","px-3","py-2","rounded",3,"click"],["type","button",1,"bg-red-500","text-white","px-3","py-2","rounded","disabled:bg-gray-300",3,"click","disabled"],[3,"value"],[1,"space-y-4"],["class","bg-white shadow rounded-lg overflow-hidden voucher-card",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","voucher-card"],[1,"px-6","py-4","flex","justify-between","items-center","cursor-pointer","hover:bg-gray-50",3,"click"],[1,"flex-1","grid","grid-cols-4","gap-4"],[1,"text-blue-600","no-print"],["class","px-6 py-4 bg-gray-50 border-t",4,"ngIf"],[1,"px-6","py-4","bg-gray-50","border-t"],[1,"min-w-full"],[1,"bg-gray-100"],[1,"px-4","py-2","text-left","text-sm"],["class","border-t",4,"ngFor","ngForOf"],[1,"bg-red-50","font-bold"],["colspan","5",1,"px-4","py-2","text-right"],[1,"px-4","py-2","text-red-600"],[1,"mt-4","flex","gap-2","no-print"],[1,"bg-indigo-600","hover:bg-indigo-700","text-white","px-4","py-2","rounded",3,"click"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded",3,"click"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded",3,"click"],[1,"border-t"],[1,"px-4","py-2"],[1,"text-center","py-8","text-gray-500"]],template:function(r,t){r&1&&(n(0,"div",0)(1,"h1",1),o(2,"Bons d'Entr\xE9e (Multi-Produits)"),i(),F(3,Ne,6,1,"div",2),n(4,"div",3)(5,"input",4),x("ngModelChange",function(s){return t.onSearchChange(s)}),i(),n(6,"div",5)(7,"button",6),x("click",function(){return t.printList()}),H(),n(8,"svg",7),T(9,"path",8),i(),Q(),n(10,"span"),o(11,"Imprimer Liste"),i()(),n(12,"button",9),x("click",function(){return t.toggleForm()}),F(13,Le,2,0,"span",10)(14,Be,2,0,"span",10),i()()(),n(15,"div",11)(16,"h3",12),H(),n(17,"svg",13),T(18,"path",14),i(),o(19," Filtres Avanc\xE9s "),i(),Q(),n(20,"div",15)(21,"div")(22,"label",16),o(23,"Fournisseur"),i(),n(24,"ng-select",17),w(25,"async"),x("ngModelChange",function(s){return t.onSupplierFilterChange(s)}),i()(),n(26,"div")(27,"label",16),o(28,"Date D\xE9but"),i(),n(29,"input",18),x("ngModelChange",function(s){return t.onDateFromChange(s)}),i()(),n(30,"div")(31,"label",16),o(32,"Date Fin"),i(),n(33,"input",18),x("ngModelChange",function(s){return t.onDateToChange(s)}),i()(),n(34,"div")(35,"label",16),o(36,"Trier par"),i(),n(37,"select",19),x("ngModelChange",function(s){return t.onSortChange(s)}),n(38,"option",20),o(39),i(),n(40,"option",21),o(41),i(),n(42,"option",22),o(43),i()()(),n(44,"div")(45,"label",16),o(46,"Montant Min (DT)"),i(),n(47,"input",23),x("ngModelChange",function(s){return t.onMinAmountChange(s)}),i()(),n(48,"div")(49,"label",16),o(50,"Montant Max (DT)"),i(),n(51,"input",24),x("ngModelChange",function(s){return t.onMaxAmountChange(s)}),i()()(),n(52,"div",25)(53,"button",26),x("click",function(){return t.clearFilters()}),o(54," R\xE9initialiser Filtres "),i()()(),F(55,ze,40,16,"div",27)(56,We,5,6,"div",28),i()),r&2&&(d(3),h("ngIf",t.errorMessage),d(2),h("ngModel",t.searchTerm),d(8),h("ngIf",!t.showForm),d(),h("ngIf",t.showForm),d(10),h("ngModel",t.selectedSupplier)("items",B(25,17,t.suppliers$)??R(19,W))("clearable",!0),d(5),h("ngModel",t.dateFrom),d(4),h("ngModel",t.dateTo),d(4),h("ngModel",t.sortBy),d(2),_(" Date ",t.sortBy==="date"?t.sortOrder==="asc"?"\u2191":"\u2193":""," "),d(2),_(" Fournisseur ",t.sortBy==="supplier"?t.sortOrder==="asc"?"\u2191":"\u2193":""," "),d(2),_(" Montant ",t.sortBy==="amount"?t.sortOrder==="asc"?"\u2191":"\u2193":""," "),d(4),h("ngModel",t.minAmount),d(4),h("ngModel",t.maxAmount),d(4),h("ngIf",t.showForm),d(),h("ngIf",!t.isLoading))},dependencies:[Ee,ue,be,ve,le,pe,xe,de,se,me,fe,he,ge,De,$e,oe,te,ie,_e,ce,ne,re],styles:[".container[_ngcontent-%COMP%]{max-width:1200px}button[_ngcontent-%COMP%]{transition:all .2s ease-in-out}@media (max-width: 768px){table[_ngcontent-%COMP%]{display:block;overflow-x:auto}}"]});let c=u;return c})();export{ut as EntryVoucherComponent};
