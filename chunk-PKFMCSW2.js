import{a as Tt}from"./chunk-EGPMFT7I.js";import{a as $t,b as Ft}from"./chunk-JFFEMBUM.js";import{c as ot}from"./chunk-NAZHZL2Z.js";import{a as Vt}from"./chunk-MNEFO67F.js";import{a as D,b as Et,d as wt,f as U,h as M,i as N,k as St,l as Ct,n as j}from"./chunk-37E4UQA3.js";import{b as at,c as w,d as dt,e as st,g as lt,h as ct,i as ut,j as mt,k as pt,l as ht,m as gt,n as xt,o as ft,p as bt,r as vt,s as _t,t as yt}from"./chunk-JJK6J4PC.js";import"./chunk-ERIR3R6Y.js";import{A as Y,Ia as s,Ib as o,Jb as B,Kb as E,O as z,Qb as H,Sa as P,Vb as S,Wa as X,Wb as L,Xb as A,_a as T,a as q,aa as J,b as O,d as R,db as Z,ea as K,jb as h,k as F,ka as C,kb as r,la as V,lb as i,ma as G,mb as $,na as Q,tb as k,tc as tt,ub as f,uc as et,wb as b,wc as it,xc as nt,yc as rt,z as W}from"./chunk-JV3ZGQQZ.js";var Dt=(()=>{let p=class p{constructor(t){this.firestore=t}getExitVouchers(){let t=U(this.firestore,"exitVouchers"),n=Ct(t,St("date","desc"));return wt(n,{idField:"id"})}addExitVoucher(t){return R(this,null,function*(){let n=U(this.firestore,"exitVouchers"),e=j(this.firestore),d=M(n);e.set(d,O(q({},t),{createdAt:D.now()}));for(let l of t.products){let g=M(this.firestore,"products",l.productId),u=yield N(g);if(u.exists()){let _=u.data().quantity||0,y=Math.max(0,_-l.quantity);e.update(g,{quantity:y})}}yield e.commit()})}updateExitVoucher(t,n){return R(this,null,function*(){let e=M(this.firestore,"exitVouchers",t),d=j(this.firestore),l=yield N(e);if(l.exists()){let g=l.data();if(g.products)for(let u of g.products){let _=M(this.firestore,"products",u.productId),y=yield N(_);if(y.exists()){let x=y.data().quantity||0;d.update(_,{quantity:x+u.quantity})}}if(n.products)for(let u of n.products){let _=M(this.firestore,"products",u.productId),y=yield N(_);if(y.exists()){let x=y.data().quantity||0,m=Math.max(0,x-u.quantity);d.update(_,{quantity:m})}}}d.update(e,n),yield d.commit()})}deleteExitVoucher(t){return R(this,null,function*(){let n=M(this.firestore,"exitVouchers",t),e=j(this.firestore),d=yield N(n);if(d.exists()){let l=d.data();if(l.products)for(let g of l.products){let u=M(this.firestore,"products",g.productId),_=yield N(u);if(_.exists()){let y=_.data().quantity||0;e.update(u,{quantity:y+g.quantity})}}}e.delete(n),yield e.commit()})}generateVoucherNumber(){let t=new Date,n=t.getFullYear(),e=String(t.getMonth()+1).padStart(2,"0"),d=String(t.getDate()).padStart(2,"0"),l=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`SRT-${n}${e}${d}-${l}`}};p.\u0275fac=function(n){return new(n||p)(K(Et))},p.\u0275prov=J({token:p,factory:p.\u0275fac,providedIn:"root"});let c=p;return c})();var Mt=()=>[];function kt(c,p){if(c&1){let a=k();r(0,"div",29)(1,"strong"),o(2,"Erreur :"),i(),o(3),r(4,"button",30),f("click",function(){C(a);let n=b();return V(n.errorMessage="")}),o(5,"\xD7"),i()()}if(c&2){let a=b();s(3),E(" ",a.errorMessage," ")}}function Bt(c,p){c&1&&(r(0,"span"),o(1,"+ Ajouter Bon"),i())}function Lt(c,p){c&1&&(r(0,"span"),o(1,"Fermer"),i())}function qt(c,p){if(c&1&&(r(0,"option",63),o(1),i()),c&2){let a=p.$implicit;h("value",a.id),s(),B(a.name)}}function Ot(c,p){if(c&1){let a=k();r(0,"div",50)(1,"div",51)(2,"label",52),o(3,"Produit *"),i(),r(4,"select",53),f("change",function(n){let e=C(a).index,d=b(2);return V(d.onProductSelected(n,e))}),r(5,"option",54),o(6,"-- S\xE9lectionnez --"),i(),T(7,qt,2,2,"option",55),S(8,"async"),i()(),r(9,"div",56)(10,"label",52),o(11,"Quantit\xE9 *"),i(),$(12,"input",57),i(),r(13,"div",56)(14,"label",52),o(15,"Prix Unit. (DT) *"),i(),$(16,"input",58),i(),r(17,"div",56)(18,"label",52),o(19,"Sous-total"),i(),$(20,"input",59),S(21,"number"),i(),r(22,"div",60)(23,"button",61),f("click",function(){C(a);let n=b(2);return V(n.addProductLine())}),o(24," + "),i(),r(25,"button",62),f("click",function(){let n=C(a).index,e=b(2);return V(e.removeProductLine(n))}),o(26," - "),i()()()}if(c&2){let a=p.index,t=b(2);h("formGroupName",a),s(7),h("ngForOf",L(8,4,t.products$)),s(13),h("value",A(21,6,t.calculateSubtotal(a),"1.2-2")),s(5),h("disabled",t.productsFormArray.length===1)}}function Rt(c,p){c&1&&(r(0,"span"),o(1,"Enregistrement..."),i())}function jt(c,p){if(c&1&&(r(0,"span"),o(1),i()),c&2){let a=b(2);s(),B(a.isEditing?"Mettre \xE0 jour":"Cr\xE9er Bon")}}function zt(c,p){if(c&1){let a=k();r(0,"div",31)(1,"h2",32),o(2),i(),r(3,"form",33),f("ngSubmit",function(){C(a);let n=b();return V(n.onSubmit())}),r(4,"div",15)(5,"div")(6,"label",34),o(7,"N\xB0 Bon *"),i(),$(8,"input",35),i(),r(9,"div")(10,"label",34),o(11,"Date *"),i(),$(12,"input",36),i(),r(13,"div")(14,"label",34),o(15,"Client *"),i(),$(16,"ng-select",37),S(17,"async"),i(),r(18,"div")(19,"label",34),o(20,"Destination"),i(),$(21,"input",38),i()(),r(22,"div",39)(23,"h3",40),o(24,"Produits"),i(),r(25,"div",41),T(26,Ot,27,9,"div",42),i(),r(27,"div",43)(28,"div",44)(29,"span"),o(30,"Total :"),i(),r(31,"span",45),o(32),S(33,"number"),i()()()(),r(34,"div")(35,"label",34),o(36,"Notes"),i(),$(37,"textarea",46),i(),r(38,"div",47)(39,"button",48),T(40,Rt,2,0,"span",10)(41,jt,2,1,"span",10),i(),r(42,"button",49),f("click",function(){C(a);let n=b();return V(n.resetForm())}),o(43," Annuler "),i()()()()}if(c&2){let a=b();s(2),E(" ",a.isEditing?"Modifier":"Nouveau"," Bon de Sortie "),s(),h("formGroup",a.voucherForm),s(13),h("items",L(17,10,a.customers$)??H(15,Mt))("searchable",!0)("clearable",!0),s(10),h("ngForOf",a.productsFormArray.controls),s(6),E("",A(33,12,a.calculateTotal(),"1.2-2")," DT"),s(7),h("disabled",a.isLoading||a.voucherForm.invalid),s(),h("ngIf",a.isLoading),s(),h("ngIf",!a.isLoading)}}function Gt(c,p){if(c&1&&(r(0,"tr",84)(1,"td",85),o(2),i(),r(3,"td",86),o(4),i(),r(5,"td",85),o(6),i(),r(7,"td",85),o(8),S(9,"number"),i(),r(10,"td",87),o(11),S(12,"number"),i()()),c&2){let a=p.$implicit;s(2),B(a.productName),s(2),B(a.description),s(2),B(a.quantity),s(2),E("",A(9,5,a.unitPrice,"1.2-2")," DT"),s(3),E("",A(12,8,a.subtotal,"1.2-2")," DT")}}function Qt(c,p){if(c&1){let a=k();r(0,"div",72)(1,"table",73)(2,"thead",74)(3,"tr")(4,"th",75),o(5,"Nom Produit"),i(),r(6,"th",75),o(7,"Description"),i(),r(8,"th",75),o(9,"Quantit\xE9"),i(),r(10,"th",75),o(11,"Prix Unit"),i(),r(12,"th",75),o(13,"Sous-total"),i()()(),r(14,"tbody"),T(15,Gt,13,11,"tr",76),r(16,"tr",77)(17,"td",78),o(18,"Total :"),i(),r(19,"td",79),o(20),S(21,"number"),i()()()(),r(22,"div",80)(23,"button",81),f("click",function(){C(a);let n=b().$implicit,e=b(2);return V(e.editVoucher(n))}),o(24," Modifier "),i(),r(25,"button",82),f("click",function(){C(a);let n=b().$implicit,e=b(2);return V(e.deleteVoucher(n.id,n.voucherNumber))}),o(26," Supprimer "),i(),r(27,"button",83),f("click",function(){C(a);let n=b().$implicit,e=b(2);return V(e.printItem(n))}),o(28," Imprimer ce Bon "),i()()()}if(c&2){let a=b().$implicit;s(15),h("ngForOf",a==null?null:a.products),s(5),E(" ",A(21,2,a==null?null:a.totalAmount,"1.2-2")," DT ")}}function Ht(c,p){if(c&1){let a=k();r(0,"div",67)(1,"div",68),f("click",function(){let n=C(a).$implicit,e=b(2);return V(e.toggleExpand(n.id))}),r(2,"div",69)(3,"div")(4,"strong"),o(5,"N\xB0 :"),i(),o(6),i(),r(7,"div")(8,"strong"),o(9,"Date:"),i(),o(10),i(),r(11,"div")(12,"strong"),o(13,"Client:"),i(),o(14),i(),r(15,"div")(16,"strong"),o(17,"Total:"),i(),o(18),S(19,"number"),i()(),r(20,"button",70),o(21),i()(),T(22,Qt,29,5,"div",71),i()}if(c&2){let a=p.$implicit,t=b(2);Z("data-id",a.id),s(6),E(" ",a.voucherNumber),s(4),E(" ",t.formatDate(a.date)),s(4),E(" ",a.customer),s(4),E(" ",A(19,7,a.totalAmount,"1.2-2")," DT"),s(3),E(" ",t.expandedVoucherId===a.id?"\u25BC":"\u25BA"," "),s(),h("ngIf",t.expandedVoucherId===a.id)}}function Ut(c,p){c&1&&(r(0,"div",88),o(1," Aucun bon trouv\xE9. "),i())}function Wt(c,p){if(c&1&&(r(0,"div",64),T(1,Ht,23,10,"div",65),S(2,"async"),T(3,Ut,2,0,"div",66),S(4,"async"),i()),c&2){let a,t=b();s(),h("ngForOf",L(2,2,t.filteredVouchers$)),s(2),h("ngIf",((a=L(4,4,t.filteredVouchers$))==null?null:a.length)===0)}}var ue=(()=>{let p=class p{constructor(t,n,e,d,l){this.vouchersService=t,this.productsService=n,this.customersService=e,this.fb=d,this.router=l,this.productList=[],this.isLoading=!1,this.isEditing=!1,this.editingId=null,this.errorMessage="",this.showForm=!1,this.expandedVoucherId=null,this.searchTerm="",this.searchTerm$=new F(""),this.selectedCustomer=null,this.selectedCustomer$=new F(null),this.dateFrom=null,this.dateFrom$=new F(null),this.dateTo=null,this.dateTo$=new F(null),this.minAmount=null,this.minAmount$=new F(null),this.maxAmount=null,this.maxAmount$=new F(null),this.sortBy="date",this.sortBy$=new F("date"),this.sortOrder="desc",this.sortOrder$=new F("desc");let g=new Date().toISOString().split("T")[0];this.voucherForm=this.fb.group({voucherNumber:[this.vouchersService.generateVoucherNumber(),w.required],date:[g,w.required],customer:["",w.required],destination:[""],products:this.fb.array([this.createProductLine()]),notes:[""]})}ngOnInit(){this.loadVouchers(),this.products$=this.productsService.getProducts(),this.products$.subscribe(t=>{this.productList=t}),this.customers$=this.customersService.getCustomers(),this.filteredVouchers$=Y([this.vouchers$,this.searchTerm$,this.selectedCustomer$,this.dateFrom$,this.dateTo$,this.minAmount$,this.maxAmount$,this.sortBy$,this.sortOrder$]).pipe(W(([t,n,e,d,l,g,u,_,y])=>{let x=t;if(n&&(x=x.filter(m=>m.voucherNumber.toLowerCase().includes(n.toLowerCase()))),e&&(x=x.filter(m=>m.customer===e)),d){let m=new Date(d);x=x.filter(v=>(v.date instanceof D?v.date.toDate():new Date(v.date))>=m)}if(l){let m=new Date(l);m.setHours(23,59,59),x=x.filter(v=>(v.date instanceof D?v.date.toDate():new Date(v.date))<=m)}return g!==null&&(x=x.filter(m=>(m.totalAmount||0)>=g)),u!==null&&(x=x.filter(m=>(m.totalAmount||0)<=u)),x=x.sort((m,v)=>{let I=0;if(_==="date"){let It=m.date instanceof D?m.date.toDate().getTime():new Date(m.date).getTime(),At=v.date instanceof D?v.date.toDate().getTime():new Date(v.date).getTime();I=It-At}else _==="customer"?I=m.customer.localeCompare(v.customer):_==="amount"&&(I=(m.totalAmount||0)-(v.totalAmount||0));return y==="asc"?I:-I}),x}))}get productsFormArray(){return this.voucherForm.get("products")}createProductLine(){return this.fb.group({productId:["",w.required],quantity:[1,[w.required,w.min(1)]],unitPrice:[0,[w.required,w.min(.01)]]})}addProductLine(){this.productsFormArray.push(this.createProductLine())}removeProductLine(t){this.productsFormArray.length>1&&this.productsFormArray.removeAt(t)}onProductSelected(t,n){let d=t.target.value,l=this.productsFormArray.at(n);if(!d||!l){l?.patchValue({unitPrice:0});return}let g=this.productList.find(u=>u.id===d);g?l.patchValue({unitPrice:g.price}):(l.patchValue({unitPrice:0}),console.warn(`Product not found in productList: ${d}`))}calculateSubtotal(t){let n=this.productsFormArray.at(t)?.value;return(n?.quantity||0)*(n?.unitPrice||0)}calculateTotal(){return this.productsFormArray.controls.reduce((t,n)=>{let e=n.value;return t+(e.quantity||0)*(e.unitPrice||0)},0)}loadVouchers(){this.vouchers$=this.vouchersService.getExitVouchers()}onSearchChange(t){this.searchTerm=t,this.searchTerm$.next(t)}onCustomerFilterChange(t){this.selectedCustomer=t,this.selectedCustomer$.next(t)}onDateFromChange(t){this.dateFrom=t,this.dateFrom$.next(t)}onDateToChange(t){this.dateTo=t,this.dateTo$.next(t)}onMinAmountChange(t){this.minAmount=t,this.minAmount$.next(t)}onMaxAmountChange(t){this.maxAmount=t,this.maxAmount$.next(t)}onSortChange(t){this.sortBy===t?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortBy=t,this.sortOrder=this.sortBy==="date"?"desc":"asc"),this.sortBy$.next(this.sortBy),this.sortOrder$.next(this.sortOrder)}clearFilters(){this.searchTerm="",this.searchTerm$.next(""),this.selectedCustomer=null,this.selectedCustomer$.next(null),this.dateFrom=null,this.dateFrom$.next(null),this.dateTo=null,this.dateTo$.next(null),this.minAmount=null,this.minAmount$.next(null),this.maxAmount=null,this.maxAmount$.next(null),this.sortBy="date",this.sortBy$.next("date"),this.sortOrder="desc",this.sortOrder$.next("desc")}onSubmit(){if(this.voucherForm.invalid){this.errorMessage="Veuillez remplir tous les champs obligatoires.";return}this.isLoading=!0,this.errorMessage="";let t=this.voucherForm.value,n=t.products.map(d=>{let l=this.productList.find(y=>y.id===d.productId),g=l?l.name:"Produit_Inconnu",u=l&&l.description||"Pas_de_description",_=(d.quantity||0)*(d.unitPrice||0);return O(q({},d),{productName:g,description:u,subtotal:_})}),e={voucherNumber:t.voucherNumber,date:D.fromDate(new Date(t.date)),customer:t.customer,destination:t.destination,products:n,totalAmount:this.calculateTotal(),notes:t.notes};this.isEditing&&this.editingId?this.vouchersService.updateExitVoucher(this.editingId,e).then(()=>{this.resetForm(),this.loadVouchers()}).catch(d=>{this.errorMessage="Erreur lors de la modification.",console.error(d)}).finally(()=>this.isLoading=!1):this.vouchersService.addExitVoucher(e).then(()=>{this.resetForm(),this.loadVouchers()}).catch(d=>{this.errorMessage="Erreur lors de l'ajout.",console.error(d)}).finally(()=>this.isLoading=!1)}editVoucher(t){this.isEditing=!0,this.editingId=t.id||null;let n=t.date.toDate().toISOString().split("T")[0];this.productsFormArray.clear(),t.products.forEach(e=>{this.productsFormArray.push(this.fb.group({productId:[e.productId,w.required],quantity:[e.quantity,[w.required,w.min(1)]],unitPrice:[e.unitPrice,[w.required,w.min(.01)]]}))}),this.voucherForm.patchValue({voucherNumber:t.voucherNumber,date:n,customer:t.customer,destination:t.destination,notes:t.notes}),this.showForm=!0,window.scrollTo({top:0,behavior:"smooth"})}deleteVoucher(t,n){confirm(`Supprimer le bon "${n}" ?`)&&(this.isLoading=!0,this.vouchersService.deleteExitVoucher(t).then(()=>{this.loadVouchers()}).catch(e=>{this.errorMessage="Erreur lors de la suppression.",console.error(e)}).finally(()=>this.isLoading=!1))}resetForm(){this.productsFormArray.clear(),this.productsFormArray.push(this.createProductLine());let t=new Date().toISOString().split("T")[0];this.voucherForm.patchValue({voucherNumber:this.vouchersService.generateVoucherNumber(),date:t,customer:"",destination:"",notes:""}),this.isEditing=!1,this.editingId=null,this.errorMessage="",this.showForm=!1}toggleForm(){this.showForm=!this.showForm,this.showForm||this.resetForm()}toggleExpand(t){this.expandedVoucherId=this.expandedVoucherId===t?null:t}getProductName(t){let n=this.productList.find(e=>e.id===t);return n?n.name:"Produit_Inconnu"}getDescription(t){return this.productList.find(e=>e.id===t)?.description||"Pas_de_description"}getSubtotal(t){let n=t&&typeof t.quantity=="number"?t.quantity:0,e=t&&typeof t.unitPrice=="number"?t.unitPrice:0;return n*e}formatDate(t){if(!t)return"-";let n;return t instanceof D?n=t.toDate():n=new Date(t),isNaN(n.getTime())?"-":n.toLocaleDateString("fr-FR")}printList(){this.filteredVouchers$.pipe(z(1)).subscribe(t=>{if(!t||t.length===0){alert("Aucun bon \xE0 imprimer.");return}this.generatePrintHTML(t)})}generatePrintHTML(t){let n=window.open("","_blank","width=900,height=700");if(!n){alert("\u274C Popup bloqu\xE9e !");return}let e=new Date().toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),d=t.length,l=t.reduce((m,v)=>m+(v.totalAmount||0),0),g=t.reduce((m,v)=>m+v.products.length,0),u=[];this.searchTerm&&u.push(`Recherche: "${this.searchTerm}"`),this.selectedCustomer&&u.push(`Client: ${this.selectedCustomer}`),this.dateFrom&&u.push(`Date D\xE9but: ${new Date(this.dateFrom).toLocaleDateString("fr-FR")}`),this.dateTo&&u.push(`Date Fin: ${new Date(this.dateTo).toLocaleDateString("fr-FR")}`),this.minAmount!==null&&u.push(`Montant Min: ${this.minAmount} DT`),this.maxAmount!==null&&u.push(`Montant Max: ${this.maxAmount} DT`);let _={date:"Date",customer:"Client",amount:"Montant"};u.push(`Tri: ${_[this.sortBy]} (${this.sortOrder==="asc"?"\u2191":"\u2193"})`);let y=t.map((m,v)=>`
      <tr>
        <td>${v+1}</td>
        <td>${m.voucherNumber}</td>
        <td>${this.formatDate(m.date)}</td>
        <td>${m.customer}</td>
        <td>${m.products.length}</td>
        <td>${(m.totalAmount||0).toFixed(2)} DT</td>
      </tr>
    `).join(""),x=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Liste Bons de Sortie - ${e}</title>
        <style>
          @page { margin: 15mm; size: A4 landscape; }
          body { font-family: Arial, sans-serif; margin: 0; padding: 15px; font-size: 10pt; }
          .header { text-align: center; margin-bottom: 15px; border-bottom: 2px solid #dc2626; padding-bottom: 10px; }
          .header h1 { font-size: 20pt; color: #dc2626; margin: 0 0 5px 0; }
          .filters { background: #fef2f2; padding: 8px; margin-bottom: 12px; border-left: 3px solid #dc2626; }
          .filters h3 { font-size: 11pt; margin: 0 0 5px 0; }
          .filters ul { list-style: none; padding: 0; margin: 0; }
          .filters li { font-size: 9pt; margin: 2px 0; }
          .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
          .stat { background: #f9fafb; border: 1px solid #e5e7eb; padding: 8px; text-align: center; }
          .stat .label { font-size: 8pt; color: #666; }
          .stat .value { font-size: 14pt; font-weight: bold; color: #dc2626; }
          table { width: 100%; border-collapse: collapse; }
          thead { background: #dc2626; color: white; }
          th, td { padding: 6px 8px; text-align: left; border: 1px solid #ddd; font-size: 9pt; }
          tbody tr:nth-child(even) { background: #f9fafb; }
          tfoot { background: #fef2f2; font-weight: bold; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>\u{1F4E4} Bons de Sortie - Liste</h1>
          <p>Date d'impression : ${e}</p>
        </div>
        <div class="filters">
          <h3>Filtres Appliqu\xE9s</h3>
          <ul>${u.map(m=>`<li>\u2022 ${m}</li>`).join("")}</ul>
        </div>
        <div class="stats">
          <div class="stat"><div class="label">Total Bons</div><div class="value">${d}</div></div>
          <div class="stat"><div class="label">Total Produits</div><div class="value">${g}</div></div>
          <div class="stat"><div class="label">Montant Total</div><div class="value">${l.toFixed(2)} DT</div></div>
        </div>
        <table>
          <thead>
            <tr><th>#</th><th>N\xB0 Bon</th><th>Date</th><th>Client</th><th>Produits</th><th>Montant</th></tr>
          </thead>
          <tbody>${y}</tbody>
          <tfoot>
            <tr><td colspan="4">TOTAL (${d} bons)</td><td>${g}</td><td>${l.toFixed(2)} DT</td></tr>
          </tfoot>
        </table>
      </body>
      </html>
    `;n.document.write(x),n.document.close(),n.focus(),setTimeout(()=>n.print(),500)}printItem(t){this.filteredVouchers$.pipe(z(1)).subscribe(n=>{let e=n.find(u=>u.id===t.id);if(!e){console.error("Bon de sortie non trouv\xE9 pour impression:",t.id),alert("Erreur : Bon de sortie non trouv\xE9.");return}let d=window.open("","_blank","width=800,height=600");if(!d){alert("\u274C Popup bloqu\xE9e ! Veuillez autoriser les popups pour ce site.");return}let l=e.products.map(u=>`
        <tr>
          <td>${u.productName||"N/A"}</td>
          <td class="description">${this.getDescription(u.productId)}</td>
          <td>${u.quantity||0}</td>
          <td>${(u.unitPrice||0).toFixed(2)} DT</td>
          <td>${(u.subtotal||0).toFixed(2)} DT</td>
        </tr>
      `).join(""),g=`<!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>Bon de Sortie ${e.voucherNumber}</title>
          <style>
            /* Basic print styles - adapt colors if needed */
            body { font-family: Arial, sans-serif; padding: 20px; font-size: 10pt; }
            h1 { text-align: center; border-bottom: 2px solid #000; margin-bottom: 20px; padding-bottom: 10px; }
            .details-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
            .details-table th, .details-table td { padding: 8px; border: 1px solid #ddd; text-align: left; }
            .details-table th { background: #f3f4f6; width: 30%; }
            .products-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
            .products-table th, .products-table td { padding: 8px; border: 1px solid #ddd; text-align: left; }
            .products-table th { background: #f3f4f6; }
            .products-table tfoot th, .products-table tfoot td { font-weight: bold; background: #fee2e2; } /* Light red footer */
            .description { font-size: 9pt; color: #555; font-style: italic; max-width: 200px; word-wrap: break-word; }
            .total-amount { color: #dc2626; } /* Red total */
          </style>
        </head>
        <body>
          <h1>Bon de Sortie N\xB0 ${e.voucherNumber}</h1>
          <table class="details-table">
            <tr><th>Date</th><td>${this.formatDate(e.date)}</td></tr>
            <tr><th>Client</th><td>${e.customer}</td></tr>
            ${e.destination?`<tr><th>Destination</th><td>${e.destination}</td></tr>`:""}
            ${e.notes?`<tr><th>Notes</th><td>${e.notes}</td></tr>`:""}
          </table>

          <h3>Produits</h3>
          <table class="products-table">
            <thead>
              <tr>
                <th>Produit</th>
                <th>Description</th>
                <th>Quantit\xE9</th>
                <th>Prix Unit.</th>
                <th>Sous-total</th>
              </tr>
            </thead>
            <tbody>
              ${l}
            </tbody>
            <tfoot>
              <tr>
                <th colspan="4" style="text-align: right;">Total</th>
                <td class="total-amount">${(e.totalAmount||0).toFixed(2)} DT</td>
              </tr>
            </tfoot>
          </table>
        </body>
        </html>
      `;d.document.write(g),d.document.close(),setTimeout(()=>{d.focus(),d.print()},250)})}};p.\u0275fac=function(n){return new(n||p)(P(Dt),P(Vt),P(Tt),P(vt),P(ot))},p.\u0275cmp=X({type:p,selectors:[["app-exit-voucher"]],decls:57,vars:20,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","text-gray-800","mb-6"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",4,"ngIf"],[1,"flex","flex-col","md:flex-row","justify-between","items-center","mb-4","gap-4"],["type","text","placeholder","\u{1F50D} Rechercher par num\xE9ro bon...",1,"w-full","md:w-1/3","px-4","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"bg-purple-600","hover:bg-purple-700","text-white","font-bold","py-2","px-6","rounded-lg","flex","items-center","space-x-2","no-print",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"],[1,"bg-green-600","hover:bg-green-700","text-white","font-bold","py-2","px-6","rounded-lg","no-print",3,"click"],[4,"ngIf"],[1,"bg-white","shadow-md","rounded-lg","p-4","mb-6","no-print"],[1,"text-lg","font-semibold","mb-3","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["bindLabel","name","bindValue","name","placeholder","Tous",1,"w-full",3,"ngModelChange","ngModel","items","clearable"],["type","date",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],["value","date"],["value","customer"],["value","amount"],["type","number","placeholder","0",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],["type","number","placeholder","10000",1,"w-full","px-3","py-2","border","rounded-lg",3,"ngModelChange","ngModel"],[1,"mt-4"],[1,"bg-gray-500","hover:bg-gray-600","text-white","px-4","py-2","rounded-lg",3,"click"],["class","bg-white shadow-md rounded-lg p-6 mb-6 no-print",4,"ngIf"],["class","space-y-4",4,"ngIf"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","mb-4"],[1,"float-right",3,"click"],[1,"bg-white","shadow-md","rounded-lg","p-6","mb-6","no-print"],[1,"text-2xl","font-semibold","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","text-gray-700","font-medium","mb-2"],["formControlName","voucherNumber","type","text","readonly","",1,"w-full","px-4","py-2","border","rounded-lg","bg-gray-100"],["formControlName","date","type","date",1,"w-full","px-4","py-2","border","rounded-lg"],["formControlName","customer","bindLabel","name","bindValue","name","placeholder","-- S\xE9lectionnez --",1,"w-full",3,"items","searchable","clearable"],["formControlName","destination","type","text",1,"w-full","px-4","py-2","border","rounded-lg"],[1,"border-t","pt-4"],[1,"text-lg","font-semibold","mb-3"],["formArrayName","products",1,"space-y-3"],["class","grid grid-cols-1 md:grid-cols-12 gap-3 items-end bg-gray-50 p-3 rounded",3,"formGroupName",4,"ngFor","ngForOf"],[1,"mt-4","bg-red-50","p-4","rounded"],[1,"flex","justify-between","text-xl","font-bold"],[1,"text-red-600"],["formControlName","notes","rows","2",1,"w-full","px-4","py-2","border","rounded-lg"],[1,"flex","gap-4"],["type","submit",1,"bg-red-600","hover:bg-red-700","text-white","font-bold","py-2","px-6","rounded-lg","disabled:bg-gray-400",3,"disabled"],["type","button",1,"bg-gray-500","hover:bg-gray-600","text-white","font-bold","py-2","px-6","rounded-lg",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-12","gap-3","items-end","bg-gray-50","p-3","rounded",3,"formGroupName"],[1,"md:col-span-4"],[1,"block","text-sm","text-gray-600","mb-1"],["formControlName","productId",1,"w-full","px-3","py-2","border","rounded",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"md:col-span-2"],["formControlName","quantity","type","number",1,"w-full","px-3","py-2","border","rounded"],["formControlName","unitPrice","type","number","step","0.01",1,"w-full","px-3","py-2","border","rounded"],["readonly","",1,"w-full","px-3","py-2","border","rounded","bg-gray-100",3,"value"],[1,"md:col-span-2","flex","gap-2"],["type","button",1,"bg-blue-500","text-white","px-3","py-2","rounded",3,"click"],["type","button",1,"bg-red-500","text-white","px-3","py-2","rounded","disabled:bg-gray-300",3,"click","disabled"],[3,"value"],[1,"space-y-4"],["class","bg-white shadow rounded-lg overflow-hidden voucher-card",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"bg-white","shadow","rounded-lg","overflow-hidden","voucher-card"],[1,"px-6","py-4","flex","justify-between","items-center","cursor-pointer","hover:bg-gray-50",3,"click"],[1,"flex-1","grid","grid-cols-4","gap-4"],[1,"text-red-600","no-print"],["class","px-6 py-4 bg-gray-50 border-t",4,"ngIf"],[1,"px-6","py-4","bg-gray-50","border-t"],[1,"min-w-full"],[1,"bg-gray-100"],[1,"px-4","py-2","text-left","text-sm"],["class","border-t",4,"ngFor","ngForOf"],[1,"bg-red-50","font-bold"],["colspan","4",1,"px-4","py-2","text-right"],[1,"px-4","py-2","text-red-600"],[1,"mt-4","flex","gap-2","no-print"],[1,"bg-indigo-600","hover:bg-indigo-700","text-white","px-4","py-2","rounded",3,"click"],[1,"bg-red-600","hover:bg-red-700","text-white","px-4","py-2","rounded",3,"click"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-4","py-2","rounded",3,"click"],[1,"border-t"],[1,"px-4","py-2"],[1,"px-4","py-2","text-xs","text-gray-600"],[1,"px-4","py-2","font-semibold"],[1,"text-center","py-8","text-gray-500"]],template:function(n,e){n&1&&(r(0,"div",0)(1,"h1",1),o(2,"Bons de Sortie"),i(),T(3,kt,6,1,"div",2),r(4,"div",3)(5,"input",4),f("ngModelChange",function(l){return e.onSearchChange(l)}),i(),r(6,"div",5)(7,"button",6),f("click",function(){return e.printList()}),G(),r(8,"svg",7),$(9,"path",8),i(),Q(),r(10,"span"),o(11,"Imprimer Liste"),i()(),r(12,"button",9),f("click",function(){return e.toggleForm()}),T(13,Bt,2,0,"span",10)(14,Lt,2,0,"span",10),i()()(),r(15,"div",11)(16,"h3",12),G(),r(17,"svg",13),$(18,"path",14),i(),o(19," Filtres Avanc\xE9s "),i(),Q(),r(20,"div",15)(21,"div")(22,"label",16),o(23,"Client"),i(),r(24,"ng-select",17),S(25,"async"),f("ngModelChange",function(l){return e.onCustomerFilterChange(l)}),i()(),r(26,"div")(27,"label",16),o(28,"Date D\xE9but"),i(),r(29,"input",18),f("ngModelChange",function(l){return e.onDateFromChange(l)}),i()(),r(30,"div")(31,"label",16),o(32,"Date Fin"),i(),r(33,"input",18),f("ngModelChange",function(l){return e.onDateToChange(l)}),i()(),r(34,"div")(35,"label",16),o(36,"Trier par"),i(),r(37,"select",19),f("ngModelChange",function(l){return e.onSortChange(l)}),r(38,"option",20),o(39),i(),r(40,"option",21),o(41),i(),r(42,"option",22),o(43),i()()(),r(44,"div")(45,"label",16),o(46,"Montant Min (DT)"),i(),r(47,"input",23),f("ngModelChange",function(l){return e.onMinAmountChange(l)}),i()(),r(48,"div")(49,"label",16),o(50,"Montant Max (DT)"),i(),r(51,"input",24),f("ngModelChange",function(l){return e.onMaxAmountChange(l)}),i()()(),r(52,"div",25)(53,"button",26),f("click",function(){return e.clearFilters()}),o(54," R\xE9initialiser Filtres "),i()()(),T(55,zt,44,16,"div",27)(56,Wt,5,6,"div",28),i()),n&2&&(s(3),h("ngIf",e.errorMessage),s(2),h("ngModel",e.searchTerm),s(8),h("ngIf",!e.showForm),s(),h("ngIf",e.showForm),s(10),h("ngModel",e.selectedCustomer)("items",L(25,17,e.customers$)??H(19,Mt))("clearable",!0),s(5),h("ngModel",e.dateFrom),s(4),h("ngModel",e.dateTo),s(4),h("ngModel",e.sortBy),s(2),E(" Date ",e.sortBy==="date"?e.sortOrder==="asc"?"\u2191":"\u2193":""," "),s(2),E(" Client ",e.sortBy==="customer"?e.sortOrder==="asc"?"\u2191":"\u2193":""," "),s(2),E(" Montant ",e.sortBy==="amount"?e.sortOrder==="asc"?"\u2191":"\u2193":""," "),s(4),h("ngModel",e.minAmount),s(4),h("ngModel",e.maxAmount),s(4),h("ngIf",e.showForm),s(),h("ngIf",!e.isLoading))},dependencies:[yt,ct,ft,bt,at,ut,xt,dt,st,mt,gt,pt,ht,Ft,$t,rt,tt,et,_t,lt,it,nt],styles:[".container[_ngcontent-%COMP%]{max-width:1200px}button[_ngcontent-%COMP%]{transition:all .2s}@media (max-width: 768px){table[_ngcontent-%COMP%]{display:block;overflow-x:auto}}"]});let c=p;return c})();export{ue as ExitVoucherComponent};
